# Guia de Desenvolvimento

## üõ†Ô∏è Setup de Desenvolvimento

### Pr√©-requisitos

- Python 3.9 - 3.11
- Git
- ffmpeg
- (Opcional) CUDA para GPU support

### Instala√ß√£o

```bash
# 1. Clonar reposit√≥rio
git clone <repository-url>
cd whisper-transcription-api

# 2. Criar ambiente virtual
python -m venv venv

# Ativar (Linux/Mac)
source venv/bin/activate

# Ativar (Windows)
.\\venv\\Scripts\\activate

# 3. Instalar depend√™ncias
pip install -r requirements.txt

# 4. Instalar depend√™ncias de desenvolvimento
pip install pytest pytest-asyncio pytest-cov black flake8 mypy

# 5. Configurar ambiente
cp .env.example .env
```

### Configura√ß√£o do IDE

#### VS Code

Criar `.vscode/settings.json`:

```json
{
  "python.linting.enabled": true,
  "python.linting.flake8Enabled": true,
  "python.formatting.provider": "black",
  "python.testing.pytestEnabled": true,
  "python.testing.unittestEnabled": false,
  "editor.formatOnSave": true
}
```

#### PyCharm

- Configurar interpretador Python do venv
- Habilitar Black como formatador
- Configurar pytest como test runner

## üìÅ Estrutura do Projeto

```
whisper-transcription-api/
‚îú‚îÄ‚îÄ src/                          # C√≥digo fonte
‚îÇ   ‚îú‚îÄ‚îÄ domain/                   # Camada de dom√≠nio
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ entities/             # Entidades
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ value_objects/        # Objetos de valor
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ interfaces/           # Interfaces (contratos)
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ exceptions.py         # Exce√ß√µes
‚îÇ   ‚îú‚îÄ‚îÄ application/              # Camada de aplica√ß√£o
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ use_cases/            # Casos de uso
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ dtos/                 # DTOs
‚îÇ   ‚îú‚îÄ‚îÄ infrastructure/           # Camada de infraestrutura
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ youtube/              # Implementa√ß√£o YouTube
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ whisper/              # Implementa√ß√£o Whisper
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ storage/              # Implementa√ß√£o Storage
‚îÇ   ‚îú‚îÄ‚îÄ presentation/             # Camada de apresenta√ß√£o
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ api/                  # FastAPI
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ routes/           # Rotas
‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ middlewares/      # Middlewares
‚îÇ   ‚îî‚îÄ‚îÄ config/                   # Configura√ß√µes
‚îú‚îÄ‚îÄ tests/                        # Testes
‚îÇ   ‚îú‚îÄ‚îÄ unit/                     # Testes unit√°rios
‚îÇ   ‚îî‚îÄ‚îÄ integration/              # Testes de integra√ß√£o
‚îú‚îÄ‚îÄ docs/                         # Documenta√ß√£o
‚îú‚îÄ‚îÄ Dockerfile                    # Container Docker
‚îú‚îÄ‚îÄ docker-compose.yml            # Orquestra√ß√£o
‚îú‚îÄ‚îÄ requirements.txt              # Depend√™ncias
‚îú‚îÄ‚îÄ pyproject.toml               # Configura√ß√£o do projeto
‚îî‚îÄ‚îÄ README.md                    # Documenta√ß√£o principal
```

## üß™ Testes

### Executar Testes

```bash
# Todos os testes
pytest

# Com verbose
pytest -v

# Com coverage
pytest --cov=src --cov-report=html

# Apenas unit tests
pytest tests/unit/

# Apenas integration tests
pytest tests/integration/

# Teste espec√≠fico
pytest tests/unit/test_youtube_url.py
```

### Escrever Testes

#### Exemplo: Teste Unit√°rio

```python
# tests/unit/test_youtube_url.py
import pytest
from src.domain.value_objects import YouTubeURL

def test_valid_youtube_url():
    url = YouTubeURL.create("https://www.youtube.com/watch?v=dQw4w9WgXcQ")
    assert url.video_id == "dQw4w9WgXcQ"

def test_invalid_youtube_url():
    with pytest.raises(ValueError):
        YouTubeURL.create("https://invalid-url.com")
```

#### Exemplo: Teste de Integra√ß√£o

```python
# tests/integration/test_transcribe_use_case.py
import pytest
from src.application.use_cases import TranscribeYouTubeVideoUseCase
from src.application.dtos import TranscribeRequestDTO

@pytest.mark.asyncio
async def test_transcribe_video(
    transcribe_use_case: TranscribeYouTubeVideoUseCase
):
    request = TranscribeRequestDTO(
        youtube_url="https://www.youtube.com/watch?v=test",
        language="auto"
    )
    
    response = await transcribe_use_case.execute(request)
    
    assert response.transcription_id is not None
    assert response.language is not None
    assert len(response.segments) > 0
```

### Mocks e Fixtures

```python
# tests/conftest.py
import pytest
from unittest.mock import Mock
from src.domain.interfaces import IVideoDownloader

@pytest.fixture
def mock_video_downloader():
    mock = Mock(spec=IVideoDownloader)
    # Configurar comportamento do mock
    return mock
```

## üé® Code Style

### Black (Formata√ß√£o)

```bash
# Formatar todo o c√≥digo
black src/ tests/

# Verificar sem modificar
black --check src/ tests/

# Formatar arquivo espec√≠fico
black src/domain/entities/transcription.py
```

### Flake8 (Linting)

```bash
# Verificar todo o c√≥digo
flake8 src/ tests/

# Verificar arquivo espec√≠fico
flake8 src/domain/entities/transcription.py
```

### MyPy (Type Checking)

```bash
# Verificar tipos
mypy src/

# Ignorar cache
mypy --no-incremental src/
```

### Configura√ß√£o

```toml
# pyproject.toml
[tool.black]
line-length = 100
target-version = ['py311']

[tool.mypy]
python_version = "3.11"
warn_return_any = true
warn_unused_configs = true
```

## üîÑ Workflow de Desenvolvimento

### 1. Criar Nova Feature

```bash
# Criar branch
git checkout -b feature/nova-funcionalidade

# Desenvolver...

# Rodar testes
pytest

# Formatar c√≥digo
black src/ tests/

# Lint
flake8 src/ tests/

# Commit
git add .
git commit -m "feat: adiciona nova funcionalidade"
```

### 2. Adicionar Nova Entidade (Domain)

```python
# src/domain/entities/nova_entidade.py
from dataclasses import dataclass
from datetime import datetime

@dataclass
class NovaEntidade:
    """Nova entidade de dom√≠nio."""
    
    id: str
    nome: str
    criado_em: datetime
    
    def metodo_de_dominio(self) -> bool:
        """L√≥gica de neg√≥cio."""
        return True
```

### 3. Adicionar Novo Use Case (Application)

```python
# src/application/use_cases/novo_use_case.py
from src.domain.interfaces import IAlgumServico

class NovoUseCase:
    """Use case para nova funcionalidade."""
    
    def __init__(self, servico: IAlgumServico):
        self.servico = servico
    
    async def execute(self, request: RequestDTO) -> ResponseDTO:
        """Executa o use case."""
        # L√≥gica...
        return ResponseDTO(...)
```

### 4. Adicionar Nova Implementa√ß√£o (Infrastructure)

```python
# src/infrastructure/novo_servico/implementacao.py
from src.domain.interfaces import INovoServico

class NovaImplementacao(INovoServico):
    """Implementa√ß√£o concreta."""
    
    async def metodo(self, parametro: str) -> str:
        """Implementa m√©todo da interface."""
        # C√≥digo...
        return resultado
```

### 5. Adicionar Nova Rota (Presentation)

```python
# src/presentation/api/routes/nova_rota.py
from fastapi import APIRouter, Depends

router = APIRouter(prefix="/api/v1/nova", tags=["Nova"])

@router.post("")
async def endpoint(
    request: RequestDTO,
    use_case: NovoUseCase = Depends(get_use_case)
):
    """Novo endpoint."""
    return await use_case.execute(request)
```

## üêõ Debug

### Logging

```python
from loguru import logger

# Em qualquer arquivo
logger.debug("Mensagem de debug")
logger.info("Informa√ß√£o")
logger.warning("Aviso")
logger.error("Erro")
logger.exception("Erro com stacktrace")
```

### Configurar N√≠vel de Log

```env
# .env
LOG_LEVEL=DEBUG  # DEBUG, INFO, WARNING, ERROR
```

### Debug no VS Code

```json
// .vscode/launch.json
{
  "version": "0.2.0",
  "configurations": [
    {
      "name": "Python: FastAPI",
      "type": "python",
      "request": "launch",
      "module": "uvicorn",
      "args": [
        "src.presentation.api.main:app",
        "--reload"
      ],
      "jinja": true,
      "justMyCode": false
    }
  ]
}
```

## üì¶ Gerenciamento de Depend√™ncias

### Adicionar Nova Depend√™ncia

```bash
# Instalar
pip install nova-biblioteca

# Adicionar ao requirements.txt
pip freeze | grep nova-biblioteca >> requirements.txt

# Ou manualmente em requirements.txt
echo "nova-biblioteca==1.0.0" >> requirements.txt
```

### Atualizar Depend√™ncias

```bash
# Atualizar tudo
pip install -U -r requirements.txt

# Atualizar espec√≠fica
pip install -U nome-da-biblioteca
```

## üîê Vari√°veis de Ambiente

### Desenvolvimento

```env
# .env (local)
APP_ENVIRONMENT=development
LOG_LEVEL=DEBUG
WHISPER_MODEL=tiny  # Modelo menor para testes
```

### Produ√ß√£o

```env
# .env (produ√ß√£o)
APP_ENVIRONMENT=production
LOG_LEVEL=INFO
WHISPER_MODEL=base
```

## üìö Documenta√ß√£o

### Docstrings

Seguir Google Style:

```python
def funcao(parametro: str) -> bool:
    """
    Breve descri√ß√£o da fun√ß√£o.
    
    Descri√ß√£o mais detalhada se necess√°rio.
    
    Args:
        parametro: Descri√ß√£o do par√¢metro
        
    Returns:
        bool: Descri√ß√£o do retorno
        
    Raises:
        ValueError: Quando parametro √© inv√°lido
        
    Example:
        >>> funcao("teste")
        True
    """
    return True
```

### Atualizar Documenta√ß√£o

```bash
# Documenta√ß√£o na pasta docs/
# Usar Markdown para clareza
```

## üöÄ Deploy Local

### Rodar com Uvicorn

```bash
# Desenvolvimento (com reload)
uvicorn src.presentation.api.main:app --reload --port 8000

# Produ√ß√£o (m√∫ltiplos workers)
uvicorn src.presentation.api.main:app --host 0.0.0.0 --port 8000 --workers 4
```

### Rodar com Docker

```bash
# Build
docker build -t whisper-api .

# Run
docker run -p 8000:8000 --env-file .env whisper-api
```

## ü§ù Contribui√ß√£o

### Padr√µes de Commit

Seguir [Conventional Commits](https://www.conventionalcommits.org/):

```
feat: adiciona nova funcionalidade
fix: corrige bug
docs: atualiza documenta√ß√£o
style: formata√ß√£o de c√≥digo
refactor: refatora√ß√£o sem mudan√ßa de comportamento
test: adiciona ou corrige testes
chore: tarefas de build/CI
```

### Pull Request

1. Fork o projeto
2. Criar branch: `git checkout -b feature/nova-feature`
3. Commit: `git commit -m 'feat: adiciona nova feature'`
4. Push: `git push origin feature/nova-feature`
5. Abrir Pull Request

### Code Review

Checklist:
- [ ] C√≥digo segue style guide
- [ ] Testes passam
- [ ] Coverage mantido/aumentado
- [ ] Documenta√ß√£o atualizada
- [ ] Sem warnings do linter
- [ ] Types corretos (mypy)

## üéØ Melhores Pr√°ticas

### ‚úÖ Fa√ßa

- ‚úÖ Escreva testes para c√≥digo novo
- ‚úÖ Use type hints
- ‚úÖ Documente fun√ß√µes complexas
- ‚úÖ Siga Clean Architecture
- ‚úÖ Aplique SOLID principles
- ‚úÖ Use async/await corretamente
- ‚úÖ Trate exce√ß√µes apropriadamente
- ‚úÖ Valide inputs

### ‚ùå Evite

- ‚ùå L√≥gica de neg√≥cio na camada de apresenta√ß√£o
- ‚ùå Acoplamento entre camadas
- ‚ùå Depend√™ncias circulares
- ‚ùå C√≥digo duplicado
- ‚ùå Magic numbers
- ‚ùå Vari√°veis globais mut√°veis
- ‚ùå Exce√ß√µes gen√©ricas (`except Exception`)
- ‚ùå Commits diretos na main

## üìñ Recursos

### Documenta√ß√£o de Depend√™ncias

- [FastAPI](https://fastapi.tiangolo.com/)
- [Pydantic](https://pydantic-docs.helpmanual.io/)
- [Whisper](https://github.com/openai/whisper)
- [yt-dlp](https://github.com/yt-dlp/yt-dlp)

### Artigos e Tutoriais

- Clean Architecture em Python
- SOLID Principles
- FastAPI Best Practices
- Async/Await em Python

---

**Happy coding! üöÄ**
