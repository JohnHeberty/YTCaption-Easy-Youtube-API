# =============================================================================
# MAKE-VIDEO SERVICE - ENVIRONMENT CONFIGURATION
# =============================================================================
# Template de variáveis de ambiente
#
# INSTRUÇÕES:
# 1. Copie este arquivo: cp .env.example .env
# 2. Edite .env com suas configurações
# 3. NUNCA commite o arquivo .env (contém credenciais)
#
# Última atualização: 04/02/2026
# =============================================================================

# -----------------------------------------------------------------------------
# SERVIDOR E DEBUG
# -----------------------------------------------------------------------------

# Porta do servidor FastAPI
PORT=8004

# Modo debug (ativa logs verbose)
# Valores: True, False
DEBUG=False

# Nível de log
# Valores: DEBUG, INFO, WARNING, ERROR, CRITICAL
LOG_LEVEL=INFO

# Formato de log
# Valores: json, text
LOG_FORMAT=json

# Diretório de logs
LOG_DIR=./logs

# -----------------------------------------------------------------------------
# REDIS (Message Broker para Celery)
# -----------------------------------------------------------------------------

# URL de conexão Redis
# IMPORTANTE: Redis é usado APENAS para Celery (message broker + result backend)
# A blacklist de vídeos usa SQLite (não Redis)
# Formato: redis://[username:password@]host:port/db
# Exemplos:
#   - Local: redis://localhost:6379/0
#   - Docker: redis://redis:6379/0
#   - Cloud: redis://:password@redis.example.com:6379/0
REDIS_URL=redis://192.168.1.110:6379/0

# TTL do cache de jobs no Redis (horas)
# Jobs completados expiram após este período
CACHE_TTL_HOURS=24

# Tamanho máximo do cache em disco (GB)
# Previne overflow de disco
MAX_CACHE_SIZE_GB=50

# -----------------------------------------------------------------------------
# MICROSERVIÇOS DEPENDENTES
# -----------------------------------------------------------------------------

# YouTube Search Service (busca de shorts)
YOUTUBE_SEARCH_URL=https://ytsearch.loadstask.com/
# Video Downloader Service (download de shorts)
VIDEO_DOWNLOADER_URL=https://ytdownloader.loadstask.com/
# Audio Transcriber Service (transcrição de áudio)
AUDIO_TRANSCRIBER_URL=https://yttranscriber.loadstask.com/

# -----------------------------------------------------------------------------
# DIRETÓRIOS DE ARMAZENAMENTO
# -----------------------------------------------------------------------------

# Diretório para áudios enviados pelos usuários
# Organizados por job_id
AUDIO_UPLOAD_DIR=./storage/audio_uploads

# Cache de shorts baixados do YouTube
# Reutilizados entre jobs para economizar bandwidth
SHORTS_CACHE_DIR=./storage/shorts_cache

# Arquivos temporários de processamento
# Limpos automaticamente após CLEANUP_TEMP_AFTER_HOURS
TEMP_DIR=./storage/temp

# Vídeos finalizados (output)
# Disponíveis para download via /download/{job_id}
OUTPUT_DIR=./storage/output_videos

# -----------------------------------------------------------------------------
# PROCESSAMENTO DE VÍDEO
# -----------------------------------------------------------------------------

# Aspect ratio padrão para vídeos
# Valores: 9:16 (vertical), 16:9 (horizontal), 1:1 (quadrado), 4:5 (Instagram)
DEFAULT_ASPECT_RATIO=9:16

# Posição do crop ao ajustar aspect ratio
# Valores: center, top, bottom
DEFAULT_CROP_POSITION=center

# Qualidade de encoding FFmpeg
# Valores: fast (menor qualidade, mais rápido), medium, high (maior qualidade, mais lento)
DEFAULT_VIDEO_QUALITY=fast

# -----------------------------------------------------------------------------
# BLACKLIST DE VÍDEOS (SQLite - Permanente)
# -----------------------------------------------------------------------------

# Caminho do banco SQLite de blacklist
# Armazena PERMANENTEMENTE vídeos com legendas embutidas detectadas
# Entradas não expiram (blacklist permanente)
SQLITE_DB_PATH=./storage/shorts_cache/blacklist.db

# -----------------------------------------------------------------------------
# LEGENDAS (Subtitles)
# -----------------------------------------------------------------------------

# Tamanho da fonte de legendas (pixels)
SUBTITLE_FONT_SIZE=22

# Nome da fonte (deve estar instalada no sistema)
# Exemplos: Arial Black, Helvetica, Impact, Roboto Bold
SUBTITLE_FONT_NAME=Arial Black

# Cor do texto da legenda (formato ASS hexadecimal)
# Formato: &HAABBGGRR& (Alpha, Blue, Green, Red)
# Exemplos:
#   - Amarelo: &H00FFFF&
#   - Branco: &H00FFFFFF&
#   - Vermelho: &H000000FF&
SUBTITLE_COLOR=&H00FFFF&

# Cor do outline/contorno (formato ASS)
# Geralmente preto para contraste
SUBTITLE_OUTLINE_COLOR=&H000000&

# Espessura do outline (pixels)
# Valores: 0 (sem outline), 1-5 (fino a grosso)
SUBTITLE_OUTLINE=2

# Alinhamento da legenda (formato ASS)
# Valores: 2 (center-bottom), 10 (center-bottom com margem), 8 (center-middle)
SUBTITLE_ALIGNMENT=10

# Margem vertical inferior (pixels)
# Distância da legenda até a borda inferior
SUBTITLE_MARGIN_V=280

# Palavras por legenda (word-by-word mode)
# Valores: 1 (uma palavra), 2 (duas palavras), 3 (três palavras)
WORDS_PER_CAPTION=2

# -----------------------------------------------------------------------------
# TIMEOUTS E RETRIES
# -----------------------------------------------------------------------------

# Timeout geral para chamadas de API (segundos)
API_TIMEOUT=120

# Intervalo entre polls de status de download (segundos)
# Usado ao aguardar conclusão de download de shorts
DOWNLOAD_POLL_INTERVAL=3

# Máximo de polls para download (total: INTERVAL * MAX_POLLS)
# Exemplo: 3s * 40 = 120s timeout total
DOWNLOAD_MAX_POLLS=40

# Intervalo entre polls de status de transcrição (segundos)
TRANSCRIBE_POLL_INTERVAL=5

# Máximo de polls para transcrição (total: 5s * 240 = 1200s = 20 minutos)
TRANSCRIBE_MAX_POLLS=240

# -----------------------------------------------------------------------------
# CLEANUP AUTOMÁTICO
# -----------------------------------------------------------------------------

# Limpar arquivos temporários após X horas
# Arquivos em TEMP_DIR mais antigos que este valor são deletados
CLEANUP_TEMP_AFTER_HOURS=1

# Limpar vídeos de output após X horas
# Vídeos finalizados são mantidos por este período antes de serem deletados
CLEANUP_OUTPUT_AFTER_HOURS=24

# Limpar cache de shorts após X dias
# Shorts baixados são mantidos em cache por este período
CLEANUP_SHORTS_CACHE_AFTER_DAYS=30

# =============================================================================
# VARIÁVEIS OPCIONAIS (Avançado)
# =============================================================================

# -----------------------------------------------------------------------------
# OCR (Optical Character Recognition)
# -----------------------------------------------------------------------------

# Threshold de confidence para detecção de legendas embutidas
# Valores: 0.0 (detecta tudo) a 1.0 (muito restritivo)
# Padrão: 0.40
OCR_CONFIDENCE_THRESHOLD=0.40

# Frames analisados POR SEGUNDO (nova estratégia)
# Mais fps = mais preciso, mas mais lento
# Padrão: 3 fps
# Exemplo: OCR_FRAMES_PER_SECOND=3 em vídeo de 60s = 180 frames analisados
OCR_FRAMES_PER_SECOND=3

# Limite máximo de frames para evitar OOM
# Padrão: 240 frames (equivalente a 40s @ 6fps ou 60s @ 4fps)
# Valores recomendados: 180-300 frames
OCR_MAX_FRAMES=240

# -----------------------------------------------------------------------------
# VAD (Voice Activity Detection)
# -----------------------------------------------------------------------------

# Threshold de VAD para detecção de fala
# Valores: 0.0 (detecta tudo como fala) a 1.0 (muito restritivo)
# Padrão: 0.5
VAD_THRESHOLD=0.5

# Modelo VAD a usar
# Valores: webrtc (rápido), silero (preciso)
# Padrão: webrtc
VAD_MODEL=webrtc

# -----------------------------------------------------------------------------
# CELERY (Task Queue)
# -----------------------------------------------------------------------------

# Concorrência de workers Celery
# Número de processos paralelos por worker
# Padrão: 4 (ajustar baseado em CPUs disponíveis)
CELERY_WORKER_CONCURRENCY=4

# Prefetch multiplier
# Quantas tarefas cada worker busca antecipadamente
# Padrão: 1 (uma tarefa por vez)
CELERY_WORKER_PREFETCH_MULTIPLIER=1

# Task timeout (segundos)
# Tempo máximo para uma tarefa completar
# Padrão: 3600 (1 hora)
CELERY_TASK_TIME_LIMIT=3600

# -----------------------------------------------------------------------------
# FFMPEG
# -----------------------------------------------------------------------------

# Codec de vídeo
# Padrão: libx264
FFMPEG_VIDEO_CODEC=libx264

# Codec de áudio
# Padrão: aac
FFMPEG_AUDIO_CODEC=aac

# Preset de encoding
# Valores: ultrafast, superfast, veryfast, faster, fast, medium, slow, slower, veryslow
# Padrão: fast
FFMPEG_PRESET=fast

# CRF (Constant Rate Factor)
# Qualidade de vídeo: 0 (lossless) a 51 (péssima)
# Padrão: 23 (boa qualidade)
FFMPEG_CRF=23

# =============================================================================
# NOTAS IMPORTANTES
# =============================================================================
#
# 1. Segurança:
#    - NUNCA commite o arquivo .env para Git
#    - Use secrets managers em produção (AWS Secrets Manager, HashiCorp Vault)
#    - Rote credenciais regularmente
#
# 2. Docker:
#    - Use docker-compose.yml para passar variáveis de ambiente
#    - Ou use arquivo .env no diretório do docker-compose
#
# 3. Desenvolvimento vs Produção:
#    - Use .env.development e .env.production
#    - Altere DEBUG=True apenas em desenvolvimento
#    - Use URLs absolutas (http://host:port) em produção
#
# 4. Performance:
#    - Ajuste CELERY_WORKER_CONCURRENCY baseado em recursos disponíveis
#    - Aumente MAX_CACHE_SIZE_GB se tiver espaço em disco
#    - Use DEFAULT_VIDEO_QUALITY=fast para menor latência
#
# 5. Monitoramento:
#    - Habilite LOG_FORMAT=json para parsing automático
#    - Use LOG_LEVEL=DEBUG para troubleshooting
#    - Monitore métricas em /metrics (Prometheus)
#
# =============================================================================
