# ===== CONFIGURAÇÃO DO SERVIÇO DE TRANSCRIÇÃO DE ÁUDIO =====
# Copie este arquivo para .env e ajuste os valores conforme necessário

# ===== APLICAÇÃO =====
APP_NAME=Audio Transcription Service
VERSION=2.0.0
ENVIRONMENT=development  # development, staging, production
DEBUG=false
TZ=America/Sao_Paulo

# ===== SERVIDOR =====
HOST=0.0.0.0
DIVISOR=3
PORT=800${DIVISOR}
WORKERS=1  # Número de workers Uvicorn

# ===== REDIS =====
# Para Docker Compose: redis://redis:6379/0
# Para desenvolvimento local: redis://localhost:6379/0
# Para Redis remoto: redis://usuario:senha@host:porta/db
REDIS_URL=redis://192.168.1.110:6379/${DIVISOR}
REDIS_MIN_MEMORY_BYTES=52428800  # Mínimo de 50MB para inicialização (50MB)
DATABASE__MIN_MEMORY_BYTES=52428800
DATABASE__MAX_CONNECTIONS=20
DATABASE__CONNECTION_TIMEOUT=5
DATABASE__RETRY_ATTEMPTS=5

# ===== CELERY =====
CELERY_BROKER_URL=${REDIS_URL}  # Usa mesma URL do Redis
CELERY_RESULT_BACKEND=${REDIS_URL}  # Usa mesma URL do Redis
CELERY_TASK_TIME_LIMIT=1800  # 30 minutos máximo por task
CELERY_TASK_SOFT_TIME_LIMIT=1600  # 26.6 minutos soft limit
CELERY_WORKER_PREFETCH_MULTIPLIER=1
CELERY_WORKER_MAX_TASKS_PER_CHILD=50

# ===== CACHE =====
CACHE__TTL_HOURS=24  # 1-168 (7 dias máximo)
CACHE__CLEANUP_INTERVAL_MINUTES=30  # 5-1440
CACHE__MAX_CACHE_SIZE_MB=2048
CACHE_TTL_HOURS=24
CACHE_CLEANUP_INTERVAL_MINUTES=30
CACHE_MAX_SIZE_MB=2048

# ===== LIMITES DE ARQUIVO =====
MAX_FILE_SIZE_MB=2048  # Tamanho máximo do arquivo (1-2000MB)
MAX_DURATION_MINUTES=240  # Duração máxima do áudio (1-240 minutos)
PROCESSING__MAX_FILE_SIZE_MB=2048
PROCESSING__MAX_DURATION_MINUTES=240
PROCESSING__MAX_CONCURRENT_JOBS=2
PROCESSING__JOB_TIMEOUT_MINUTES=60
PROCESSING__WHISPER_MODEL=base

# ===== WHISPER - MODELO =====
# Modelos disponíveis: tiny, base, small, medium, large, large-v2, large-v3
# tiny: ~39M, ~1GB VRAM, ~32x mais rápido
# base: ~74M, ~1GB VRAM, ~16x mais rápido (RECOMENDADO PARA PRODUÇÃO)
# small: ~244M, ~2GB VRAM, ~6x mais rápido
# medium: ~769M, ~5GB VRAM, ~2x mais rápido
# large: ~1550M, ~10GB VRAM, melhor qualidade
WHISPER_MODEL=small
WHISPER_DEVICE=cuda  # cpu ou cuda (se tiver GPU NVIDIA)
WHISPER_FALLBACK_CPU=true  # Fallback para CPU se GPU falhar
WHISPER_DOWNLOAD_ROOT=./models
WHISPER_MODEL_DIR=./models
WHISPER_OUTPUT_DIR=./transcriptions
WHISPER_DEFAULT_LANGUAGE=auto  # auto para detecção automática
WHISPER_COMPUTE_TYPE=int8  # int8, float16, float32

# ===== WHISPER - CHUNKS (ACELERAÇÃO) =====
# IMPORTANTE: Processar áudio em chunks ACELERA significativamente a transcrição
# Para áudios longos (>5min), o chunking é ESSENCIAL
WHISPER_ENABLE_CHUNKING=false  # Habilitar processamento em chunks
WHISPER_CHUNK_LENGTH_SECONDS=30  # Duração de cada chunk (10-120s)
WHISPER_CHUNK_OVERLAP_SECONDS=1.0  # Overlap entre chunks para contexto (0.5-5.0s)
WHISPER_MIN_DURATION_FOR_CHUNKS=300  # Mínimo de 5 minutos para usar chunks

# ===== WHISPER - OTIMIZAÇÕES =====
WHISPER_FP16=false  # true se tiver GPU NVIDIA
WHISPER_BEAM_SIZE=5  # 1-10 (5 = padrão)
WHISPER_BEST_OF=5  # 1-10 (5 = padrão)
WHISPER_TEMPERATURE=0.0  # 0.0-1.0 (0.0 = mais preciso)
WHISPER_PATIENCE=1.0  # Paciência do beam search
WHISPER_LENGTH_PENALTY=1.0  # Penalidade para comprimento

# ===== DIRETÓRIOS =====
UPLOAD_DIR=./uploads
TRANSCRIPTION_DIR=./transcriptions
MODELS_DIR=./models
TEMP_DIR=./temp
LOG_DIR=./logs
BACKUP_DIR=./backup

# ===== LOGGING =====
LOG_LEVEL=INFO  # DEBUG, INFO, WARNING, ERROR, CRITICAL
LOG_FORMAT=json  # json ou text
LOG_ROTATION=1 day
LOG_RETENTION=30 days

# ===== TIMEOUTS =====
ASYNC_TIMEOUT_SECONDS=7200  # 2 horas
JOB_PROCESSING_TIMEOUT_SECONDS=7200  # 2 horas
POLL_INTERVAL_SECONDS=2
FFPROBE_TIMEOUT_SECONDS=60  # Timeout para análise de arquivo com ffprobe

# ===== FFMPEG =====
FFMPEG_THREADS=0  # 0 = auto
FFMPEG_AUDIO_CODEC=pcm_s16le  # Codec ideal para Whisper
FFMPEG_SAMPLE_RATE=16000  # 16kHz ideal para Whisper

# ===== MONITORAMENTO =====
MONITORING__ENABLE_PROMETHEUS=true
MONITORING__METRICS_PORT=9091
MONITORING__ENABLE_TRACING=true
MONITORING__LOG_CORRELATION_ID=true
MONITORING__STRUCTURED_LOGGING=true
