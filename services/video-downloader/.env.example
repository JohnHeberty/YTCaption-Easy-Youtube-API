# ===== CONFIGURAÇÃO DO SERVIÇO DE DOWNLOAD DE VÍDEOS =====
# Copie este arquivo para .env e ajuste os valores conforme necessário

# ===== APLICAÇÃO =====
APP_NAME=Video Downloader Service
VERSION=2.0.0
ENVIRONMENT=development  # development, staging, production
DEBUG=false

# ===== SERVIDOR =====
HOST=0.0.0.0
PORT=8001
WORKERS=1  # Número de workers Uvicorn

# ===== REDIS/DATABASE =====
# Para Docker Compose: redis://redis:6379/0
# Para desenvolvimento local: redis://localhost:6379/0
# Para Redis remoto: redis://usuario:senha@host:porta/db
REDIS_URL=redis://localhost:6379/0
REDIS_MIN_MEMORY_BYTES=52428800  # Mínimo de 50MB para inicialização (50MB)
DATABASE__MIN_MEMORY_BYTES=52428800
DATABASE__MAX_CONNECTIONS=20
DATABASE__CONNECTION_TIMEOUT=5
DATABASE__RETRY_ATTEMPTS=5

# ===== CELERY =====
CELERY_BROKER_URL=${REDIS_URL}  # Usa mesma URL do Redis
CELERY_RESULT_BACKEND=${REDIS_URL}  # Usa mesma URL do Redis
CELERY_TASK_TIME_LIMIT=1800  # 30 minutos máximo por task
CELERY_TASK_SOFT_TIME_LIMIT=1600  # 26.6 minutos soft limit
CELERY_WORKER_PREFETCH_MULTIPLIER=1
CELERY_WORKER_MAX_TASKS_PER_CHILD=50

# ===== CACHE =====
CACHE__TTL_HOURS=24  # 1-168 (7 dias máximo)
CACHE__CLEANUP_INTERVAL_MINUTES=30  # 5-1440
CACHE__MAX_CACHE_SIZE_GB=10  # Tamanho máximo do cache em GB
CACHE_TTL_HOURS=24
CLEANUP_INTERVAL_MINUTES=30
CACHE_DIR=./cache

# ===== PROCESSAMENTO =====
PROCESSING__MAX_CONCURRENT_DOWNLOADS=2  # Downloads simultâneos
PROCESSING__JOB_TIMEOUT_MINUTES=30  # Timeout por job
PROCESSING__DEFAULT_QUALITY=best  # best, worst, 1080p, 720p, 480p, etc
PROCESSING__MAX_FILE_SIZE_GB=5  # Tamanho máximo do arquivo (1-20GB)
PROCESSING__MAX_DURATION_MINUTES=120  # Duração máxima do vídeo
MAX_CONCURRENT_DOWNLOADS=2

# ===== DOWNLOAD SETTINGS =====
DEFAULT_QUALITY=best  # best, worst, 1080p, 720p, 480p, 360p
DOWNLOAD_TIMEOUT=300  # 5 minutos timeout por download
RETRY_ATTEMPTS=3  # Número de tentativas em caso de falha
RETRY_DELAY=5  # Delay entre tentativas em segundos

# ===== USER AGENT MANAGEMENT =====
UA_QUARANTINE_HOURS=48  # Horas que um UA fica em quarentena após erros
UA_MAX_ERRORS=3  # Máximo de erros antes de quarentena
UA_ROTATION_ENABLED=true  # Rotação automática de User-Agents
UA_UPDATE_INTERVAL_HOURS=24  # Intervalo para atualizar lista de UAs

# ===== SEGURANÇA =====
SECURITY__RATE_LIMIT_REQUESTS=100  # Requests por minuto
SECURITY__RATE_LIMIT_WINDOW=60  # Janela em segundos
SECURITY__ENABLE_URL_VALIDATION=true  # Validar URLs antes de baixar
SECURITY__BLOCKED_DOMAINS=localhost,127.0.0.1,0.0.0.0  # Domínios bloqueados
SECURITY__MAX_REDIRECTS=5  # Máximo de redirecionamentos
SECURITY__ENABLE_FILE_CONTENT_VALIDATION=true
SECURITY__MAX_UPLOAD_ATTEMPTS=3
SECRET_KEY=your_secret_key_here_change_in_production
MAX_FILE_SIZE_MB=5000  # 5GB em MB
RATE_LIMIT_PER_MINUTE=10

# ===== MONITORAMENTO =====
MONITORING__ENABLE_PROMETHEUS=true
MONITORING__METRICS_PORT=9092
MONITORING__ENABLE_TRACING=true
MONITORING__LOG_CORRELATION_ID=true
MONITORING__STRUCTURED_LOGGING=true

# ===== DIRETÓRIOS =====
CACHE_DIR=./cache
DOWNLOADS_DIR=./downloads
TEMP_DIR=./temp
LOG_DIR=./logs
BACKUP_DIR=./backup

# ===== LOGGING =====
LOG_LEVEL=INFO  # DEBUG, INFO, WARNING, ERROR, CRITICAL
LOG_FORMAT=json  # json ou text
LOG_ROTATION=1 day
LOG_RETENTION=30 days

# ===== TIMEOUTS =====
ASYNC_TIMEOUT_SECONDS=1800  # 30 minutos
JOB_PROCESSING_TIMEOUT_SECONDS=1800  # 30 minutos
POLL_INTERVAL_SECONDS=2

# ===== YT-DLP SETTINGS =====
YTDLP_FORMAT=best  # Formato de vídeo padrão
YTDLP_EXTRACT_AUDIO=false  # Extrair apenas áudio
YTDLP_AUDIO_FORMAT=mp3  # Formato de áudio (mp3, m4a, opus, vorbis, wav)
YTDLP_AUDIO_QUALITY=0  # 0 (best) - 10 (worst)
YTDLP_QUIET=true  # Modo silencioso (menos logs)
YTDLP_NO_WARNINGS=false  # Desabilitar warnings
YTDLP_IGNORE_ERRORS=false  # Continuar em caso de erros
