# ===== CONFIGURAÇÃO DO SERVIÇO DE NORMALIZAÇÃO DE ÁUDIO =====
# Copie este arquivo para .env e ajuste os valores conforme necessário

# ===== APLICAÇÃO =====
APP_NAME=Audio Normalization Service
VERSION=2.0.0
ENVIRONMENT=development  # development, staging, production
DEBUG=false

# ===== SERVIDOR =====
HOST=0.0.0.0
PORT=8001
WORKERS=1  # Número de workers Uvicorn

# ===== REDIS =====
# Para Docker Compose: redis://redis:6379/0
# Para desenvolvimento local: redis://localhost:6379/0
# Para Redis remoto: redis://usuario:senha@host:porta/db
REDIS_URL=redis://localhost:6379/0

# ===== CELERY =====
CELERY_BROKER_URL=redis://localhost:6379/0
CELERY_RESULT_BACKEND=redis://localhost:6379/0
CELERY_TASK_SERIALIZER=json
CELERY_RESULT_SERIALIZER=json
CELERY_ACCEPT_CONTENT=json
CELERY_TIMEZONE=UTC
CELERY_ENABLE_UTC=true
CELERY_TASK_TRACK_STARTED=true
CELERY_TASK_TIME_LIMIT=1800  # 30 minutos máximo por task
CELERY_TASK_SOFT_TIME_LIMIT=1500  # 25 minutos soft limit
CELERY_WORKER_PREFETCH_MULTIPLIER=1
CELERY_WORKER_MAX_TASKS_PER_CHILD=100

# ===== CACHE =====
CACHE__TTL_HOURS=24  # 1-168 (7 dias máximo)
CACHE__CLEANUP_INTERVAL_MINUTES=30  # 5-1440
CACHE__MAX_CACHE_SIZE_MB=1024

# ===== PROCESSAMENTO DE ÁUDIO - LIMITES =====
MAX_FILE_SIZE_MB=500  # Tamanho máximo do arquivo (1-2000MB)
MAX_DURATION_MINUTES=120  # Duração máxima do áudio (1-240 minutos)

# ===== PROCESSAMENTO DE ÁUDIO - CHUNKS =====
# CHUNK: Processar áudio em pedaços para evitar OOM (Out of Memory)
# Valores sugeridos:
#   - Máquina com 4GB RAM: AUDIO_CHUNK_SIZE_MB=50, AUDIO_CHUNK_DURATION_SEC=60
#   - Máquina com 8GB RAM: AUDIO_CHUNK_SIZE_MB=100, AUDIO_CHUNK_DURATION_SEC=120
#   - Máquina com 16GB+ RAM: AUDIO_CHUNK_SIZE_MB=200, AUDIO_CHUNK_DURATION_SEC=300

AUDIO_CHUNK_SIZE_MB=100  # Tamanho máximo do chunk em MB (10-500MB)
AUDIO_CHUNK_DURATION_SEC=120  # Duração máxima do chunk em segundos (30-600s)
AUDIO_CHUNK_OVERLAP_SEC=2  # Overlap entre chunks para evitar cortes (0-10s)
AUDIO_ENABLE_CHUNKING=true  # Habilitar processamento em chunks

# ===== PROCESSAMENTO DE ÁUDIO - OPERAÇÕES =====
# Limites específicos para cada operação
NOISE_REDUCTION_MAX_DURATION_SEC=300  # 5 minutos máximo para noise reduction
NOISE_REDUCTION_SAMPLE_RATE=22050  # Sample rate para noise reduction (16000-48000)
NOISE_REDUCTION_CHUNK_SIZE_SEC=30  # Tamanho do chunk para noise reduction

VOCAL_ISOLATION_MAX_DURATION_SEC=180  # 3 minutos máximo para vocal isolation
VOCAL_ISOLATION_SAMPLE_RATE=44100  # Sample rate para vocal isolation
VOCAL_ISOLATION_DEVICE=cpu  # cpu ou cuda (se tiver GPU)

HIGHPASS_FILTER_CUTOFF_HZ=80  # Frequência de corte do high-pass filter (20-200Hz)
HIGHPASS_FILTER_ORDER=5  # Ordem do filtro Butterworth (1-10)

# ===== PROCESSAMENTO DE ÁUDIO - MEMÓRIA =====
# Controle de uso de memória
MAX_MEMORY_USAGE_MB=2048  # Limite de memória para processamento (512-8192MB)
MEMORY_CHECK_INTERVAL_SEC=5  # Intervalo para verificar uso de memória
ENABLE_MEMORY_PROTECTION=true  # Abortar processamento se exceder limite

# ===== SEGURANÇA =====
SECURITY__RATE_LIMIT_REQUESTS=100  # Requests por minuto
SECURITY__RATE_LIMIT_WINDOW=60  # Janela em segundos
SECURITY__ENABLE_FILE_CONTENT_VALIDATION=true
SECURITY__ENABLE_VIRUS_SCAN=false  # Requer ClamAV
SECURITY__MAX_UPLOAD_ATTEMPTS=3
SECURITY__VALIDATE_AUDIO_HEADERS=true
SECURITY__CHECK_FILE_ENTROPY=false

# ===== DIRETÓRIOS =====
UPLOAD_DIR=./uploads
PROCESSED_DIR=./processed
TEMP_DIR=./temp
LOG_DIR=./logs
BACKUP_DIR=./backup

# ===== LOGGING =====
LOG_LEVEL=INFO  # DEBUG, INFO, WARNING, ERROR, CRITICAL
LOG_FORMAT=json  # json ou text
LOG_ROTATION=1 day  # 1 hour, 1 day, 1 week
LOG_RETENTION=30 days

# ===== TIMEOUTS =====
# Timeouts para operações assíncronas
ASYNC_TIMEOUT_SECONDS=900  # 15 minutos timeout geral
JOB_PROCESSING_TIMEOUT_SECONDS=1800  # 30 minutos timeout por job
POLL_INTERVAL_SECONDS=2  # Intervalo de polling para status

# ===== OPENUNMIX (VOCAL ISOLATION) =====
OPENUNMIX_MODEL_NAME=umx  # umx, umxhq (high quality)
OPENUNMIX_TARGET=vocals  # vocals, drums, bass, other
OPENUNMIX_DEVICE=cpu  # cpu ou cuda
OPENUNMIX_PRETRAINED=true

# ===== FFMPEG =====
FFMPEG_THREADS=0  # 0 = auto, ou número específico de threads
FFMPEG_PRESET=medium  # ultrafast, superfast, veryfast, faster, fast, medium, slow, slower, veryslow
FFMPEG_AUDIO_CODEC=libopus  # Codec de áudio padrão para exportação
FFMPEG_AUDIO_BITRATE=128k  # Bitrate de áudio (64k, 128k, 192k, 256k, 320k)

# ===== DOCKER ESPECÍFICO =====
# Descomente para uso com Docker Compose
# REDIS_URL=redis://redis:6379/0
# CELERY_BROKER_URL=redis://redis:6379/0
# CELERY_RESULT_BACKEND=redis://redis:6379/0
# PYTHONPATH=/app
